# Frontend Upload Flow - FIXED ‚úÖ

## Problem Summary

Previously, the frontend `ChatBot.tsx` was sending **raw File objects** to the chatbot instead of processing them through the backend OCR pipeline. This meant:

- ‚ùå No OCR extraction
- ‚ùå No Azure Storage upload
- ‚ùå No RAG database storage
- ‚ùå No data available for queries

## Solution Implemented

### Modified File: `frontend/app/components/ChatBot.tsx`

**Function Changed:** `processFiles()`

**Previous Behavior:**

```typescript
const processFiles = (files: File[]) => {
  // Created file previews
  // Simulated processing with setTimeout
  // Never called backend OCR API ‚ùå
};
```

**New Behavior:**

```typescript
const processFiles = async (files: File[]) => {
  // 1. Create file previews (same as before)
  // 2. Upload each file to backend OCR endpoint ‚úÖ
  // 3. Wait for OCR + Azure + RAG processing ‚úÖ
  // 4. Display OCR results to user ‚úÖ
  // 5. Handle errors gracefully ‚úÖ
};
```

### Complete Upload Flow (After Fix)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     USER UPLOADS IMAGE                          ‚îÇ
‚îÇ                 (via camera or file picker)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Frontend: processFiles() in ChatBot.tsx                        ‚îÇ
‚îÇ  - Creates file preview                                          ‚îÇ
‚îÇ  - Shows "ƒêang x·ª≠ l√Ω OCR v√† l∆∞u v√†o h·ªá th·ªëng..."               ‚îÇ
‚îÇ  - Calls: POST http://localhost:8000/api/ocr/camera-ocr         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Backend: /api/ocr/camera-ocr endpoint (main.py line 51-60)     ‚îÇ
‚îÇ  - Generates session_id from file hash                          ‚îÇ
‚îÇ  - Redirects to upload_chat_image()                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Backend: upload_chat_image() (websocket_chat.py line 286-404)  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Step 1: OCR Extraction                                         ‚îÇ
‚îÇ  - Tesseract extracts text from image                           ‚îÇ
‚îÇ  - Extracts structured fields (Invoice #, Date, Total, etc.)    ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Step 2: Azure Storage Upload (line 327-336)                    ‚îÇ
‚îÇ  - Uploads image to Azure Blob Storage                          ‚îÇ
‚îÇ  - Returns permanent azure_url                                  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Step 3: PostgreSQL Storage (line 339-350)                      ‚îÇ
‚îÇ  - Saves to DocumentStorage table:                              ‚îÇ
‚îÇ    * azure_url                                                  ‚îÇ
‚îÇ    * ocr_results (JSON with extracted_text, fields)             ‚îÇ
‚îÇ    * extracted_data (JSON structured data)                      ‚îÇ
‚îÇ    * session_id, filename, upload_type                          ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Step 4: RAG Processing (line 362-369)                          ‚îÇ
‚îÇ  - Chunks extracted text                                        ‚îÇ
‚îÇ  - Generates embeddings with sentence-transformers             ‚îÇ
‚îÇ  - Stores in ChromaDB vector database                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  Returns JSON:                                                  ‚îÇ
‚îÇ  {                                                              ‚îÇ
‚îÇ    "session_id": "...",                                         ‚îÇ
‚îÇ    "ocr_results": {...},                                        ‚îÇ
‚îÇ    "azure_url": "https://...",                                  ‚îÇ
‚îÇ    "rag_processed": true                                        ‚îÇ
‚îÇ  }                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Frontend: processFiles() receives response                     ‚îÇ
‚îÇ  - Updates file status to 'processed'                           ‚îÇ
‚îÇ  - Displays OCR results:                                        ‚îÇ
‚îÇ    ‚úÖ ƒê√£ x·ª≠ l√Ω xong: filename                                   ‚îÇ
‚îÇ    üìù K·∫øt qu·∫£ OCR: [extracted text]                             ‚îÇ
‚îÇ    üíæ ƒê√£ l∆∞u v√†o h·ªá th·ªëng RAG v√† Azure Storage                 ‚îÇ
‚îÇ    üîó URL: [azure_url]                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Now when user asks: "xem d·ªØ li·ªáu h√≥a ƒë∆°n" or "cho t√¥i xem h√≥a ƒë∆°n ƒë√£ upload"
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Chatbot: handle_data_query() in chat_handler.py               ‚îÇ
‚îÇ  - Calls: POST http://localhost:8000/chat/rag-search            ‚îÇ
‚îÇ  - Query: "xem d·ªØ li·ªáu h√≥a ƒë∆°n"                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Backend: /chat/rag-search endpoint                             ‚îÇ
‚îÇ  - Embeds query with sentence-transformers                      ‚îÇ
‚îÇ  - Searches ChromaDB for similar documents                      ‚îÇ
‚îÇ  - Returns top 5 matching documents with:                       ‚îÇ
‚îÇ    * document_id                                                ‚îÇ
‚îÇ    * content (extracted text)                                   ‚îÇ
‚îÇ    * metadata (filename, azure_url, date)                       ‚îÇ
‚îÇ    * distance (similarity score)                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Chatbot: handle_data_query() builds RAG context               ‚îÇ
‚îÇ  - Formats top 5 documents into context string                  ‚îÇ
‚îÇ  - Creates prompt:                                              ‚îÇ
‚îÇ    "TH√îNG TIN T·ª™ H·ªÜ TH·ªêNG:\n[RAG context]\nC√ÇU H·ªéI: [query]"  ‚îÇ
‚îÇ  - Calls Google Gemini AI: generate_response(prompt)           ‚îÇ
‚îÇ  - Returns intelligent, context-aware answer ‚úÖ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Code Changes Made

### ChatBot.tsx Line 379 (processFiles function)

**Changed from:**

```typescript
// Simulate file processing
newFiles.forEach((uploadedFile) => {
  setTimeout(() => {
    setUploadedFiles((prev) =>
      prev.map((f) =>
        f.id === uploadedFile.id ? { ...f, status: "processed" } : f
      )
    );
  }, 2000);
});
```

**Changed to:**

```typescript
// G·ª≠i t·ª´ng file ƒë·∫øn backend ƒë·ªÉ x·ª≠ l√Ω OCR + Azure + RAG
for (const uploadedFile of newFiles) {
  try {
    const formData = new FormData();
    formData.append("file", uploadedFile.file);

    // G·ªçi backend OCR endpoint
    const response = await fetch("http://localhost:8000/api/ocr/camera-ocr", {
      method: "POST",
      body: formData,
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i file th√†nh c√¥ng
    setUploadedFiles((prev) =>
      prev.map((f) =>
        f.id === uploadedFile.id ? { ...f, status: "processed" } : f
      )
    );

    // Hi·ªÉn th·ªã k·∫øt qu·∫£ OCR
    const ocrMessage =
      `‚úÖ ƒê√£ x·ª≠ l√Ω xong: ${uploadedFile.file.name}\n\n` +
      `üìù K·∫øt qu·∫£ OCR:\n${
        result.ocr_results?.extracted_text || "Kh√¥ng tr√≠ch xu·∫•t ƒë∆∞·ª£c vƒÉn b·∫£n"
      }\n\n` +
      `üíæ ƒê√£ l∆∞u v√†o h·ªá th·ªëng RAG v√† Azure Storage\n` +
      `üîó URL: ${result.azure_url || "N/A"}`;

    setMessages((prev) => [
      ...prev,
      {
        id: Date.now().toString(),
        type: "bot",
        content: ocrMessage,
        timestamp: new Date(),
      },
    ]);
  } catch (error) {
    console.error("Error processing file:", uploadedFile.file.name, error);

    // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
    setMessages((prev) => [
      ...prev,
      {
        id: Date.now().toString(),
        type: "bot",
        content: `‚ùå L·ªói khi x·ª≠ l√Ω file: ${uploadedFile.file.name}\n${
          error instanceof Error ? error.message : "Unknown error"
        }`,
        timestamp: new Date(),
      },
    ]);
  }
}
```

## Testing Instructions

### 1. Start All Services

```powershell
# Terminal 1: Start Backend
cd f:\DoAnCN\fastapi_backend
poetry run python main.py

# Terminal 2: Start Chatbot
cd f:\DoAnCN\chatbot
python app.py

# Terminal 3: Start Frontend
cd f:\DoAnCN\frontend
npm run dev
```

### 2. Test Upload Flow

1. **Open frontend:** http://localhost:5173 or http://localhost:5174
2. **Click camera icon** or **upload file button**
3. **Upload an invoice image**
4. **Expected behavior:**
   - ‚úÖ Shows "ƒêang x·ª≠ l√Ω OCR v√† l∆∞u v√†o h·ªá th·ªëng..."
   - ‚úÖ After processing, shows:
     - "‚úÖ ƒê√£ x·ª≠ l√Ω xong: [filename]"
     - "üìù K·∫øt qu·∫£ OCR: [extracted text]"
     - "üíæ ƒê√£ l∆∞u v√†o h·ªá th·ªëng RAG v√† Azure Storage"
     - "üîó URL: [azure_url]"

### 3. Test RAG Query

1. **Type in chat:** "xem d·ªØ li·ªáu h√≥a ƒë∆°n" or "cho t√¥i xem h√≥a ƒë∆°n ƒë√£ upload"
2. **Expected behavior:**
   - ‚úÖ Returns intelligent response with invoice data
   - ‚úÖ Uses Google Gemini AI to format response
   - ‚úÖ Includes information from uploaded invoice

### 4. Verify Backend Logs

Check backend terminal for logs:

```
üì§ Chat upload: [filename]
Processing document for RAG: [doc_id]
Added 3 chunks to RAG database
RAG stats: {'total_documents': 1, ...}
```

### 5. Manual API Test (Optional)

```powershell
# Test upload endpoint directly
curl.exe -X POST `
  -F "file=@path\to\image.jpg" `
  http://localhost:8000/api/ocr/camera-ocr

# Check RAG stats
curl http://localhost:8000/chat/stats

# Test RAG search
curl.exe -X POST `
  -H "Content-Type: application/json" `
  -d '{"query":"h√≥a ƒë∆°n","top_k":5}' `
  http://localhost:8000/chat/rag-search
```

## Verification Checklist

- [x] ‚úÖ Frontend modified: `processFiles()` now calls backend OCR API
- [x] ‚úÖ Backend endpoint exists: `/api/ocr/camera-ocr` (main.py line 51-60)
- [x] ‚úÖ Full pipeline implemented: OCR ‚Üí Azure ‚Üí PostgreSQL ‚Üí RAG
- [x] ‚úÖ Error handling added to frontend
- [x] ‚úÖ OCR results displayed to user
- [ ] ‚è≥ **NEXT: Test with real image upload**
- [ ] ‚è≥ **NEXT: Verify ChromaDB receives documents**
- [ ] ‚è≥ **NEXT: Test RAG query returns data**

## Expected Results After Fix

1. **Upload image** ‚Üí Backend processes ‚Üí Displays OCR results
2. **ChromaDB** ‚Üí Should have documents (check `f:\DoAnCN\fastapi_backend\chroma_db`)
3. **Azure Storage** ‚Üí Should have blob with URL
4. **PostgreSQL** ‚Üí Should have DocumentStorage record
5. **Query "xem d·ªØ li·ªáu"** ‚Üí Returns intelligent response with invoice data

## Troubleshooting

### If upload fails:

1. Check backend terminal for errors
2. Verify Tesseract is installed: `tesseract --version`
3. Check Azure credentials in `.env`
4. Check PostgreSQL connection

### If RAG query returns "Ch∆∞a c√≥ d·ªØ li·ªáu":

1. Check ChromaDB directory: `ls f:\DoAnCN\fastapi_backend\chroma_db`
2. Check RAG stats: `curl http://localhost:8000/chat/stats`
3. Verify upload reached RAG step (check backend logs)

### If frontend shows error:

1. Check browser console (F12)
2. Verify backend is running: `curl http://localhost:8000/health`
3. Check CORS settings in backend
